from pwn import *
import os
"""
need 100 args in argv 65 need to be '\x00' 66 '\x20\x0a\x0d'
67 to be the port we will connect to  in stage 5 
"""

argv = ['a'] * 100 
argv[0] = 'input2'
argv[65] = '\x00'
argv[66] =  '\x20\x0a\x0d'

#for stage 5
argv[67] = '4444'


#second stagne - open a pipe for stdin and stderr if using python 2 no need for b''
r1,w1 = os.pipe()
r2,w2 = os.pipe()
os.write(w1,'\x00\x0a\x00\xff')
os.write(w2,'\x00\x0a\x02\xff')

# 3 stage - create a dict of env var name and value
# if(strcmp("\xca\xfe\xba\xbe", getenv("\xde\xad\xbe\xef"))) 
env  = {'\xde\xad\xbe\xef':'\xca\xfe\xba\xbe'}


# stage 4: create a file
with open('\x0a','w') as f:
    f.write('\x00\x00\x00\x00')




p = process(executable='/home/input2/input',
	    argv=argv,
	    stdin=r1, stderr=r2,
	    env=env)

#stage 5
#if( recv(cd, buf, 4, 0) != 4 ) return 0;
#if(memcmp(buf, "\xde\xad\xbe\xef", 4)) return 0;
connect  = remote('localhost', 4444)
connect.sendline('\xde\xad\xbe\xef')


p.interactive()
